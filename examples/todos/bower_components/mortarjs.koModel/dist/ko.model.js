/**
 * MortarJs.koModel Copyright (c) 2014 Miguel Castillo.
 * Licensed under MIT
 *
 * https://github.com/MiguelCastillo/MortarJs.koModel
 */

(function(e,t){typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=t(require("Mortar"),require("ko")):typeof define=="function"&&define.amd?define(["Mortar","ko"],t):t(e.Mortar,e.ko)})(this,function(e,t){var n=function(e){function n(e,t,r){return n.serialize(e,t,r)}return n.primitiveTypes={"undefined":!0,"boolean":!0,number:!0,string:!0},n.getType=function(e){if(e instanceof Array)return"array";var t=typeof e;if(n.primitiveTypes.hasOwnProperty(t))return"primitive";if(t==="object")return"object";throw"Invalid data type"},n.array=function(e,r,i){var s=0,o=e.length,u=!1,a=t.isObservable(r);i=i||{},o&&(u=n.getType(e[0]));for(;s<o;s++)e[s]=n[u](e[s],r,i);return a===!0?(r(e),r):t.observableArray(e)},n.primitive=function(e,n,r){var i=t.isObservable(n);return i===!0?(n(e),n):t.observable(e)},n.object=function(e,t,r){var i,s,o,u=!1;t=t||{},r=r||{};for(var a in e){if(e.hasOwnProperty(a)===!1)continue;u=t.hasOwnProperty(a),s=e[a],i=n.getType(s),o=n[i](s,t[a],r[a]),u===!1&&(t[a]=o)}return t},n.serialize=function(e,t,r){var i=n.getType(e);return n[i](e,t,r)},n.deserialize=function(e){return t.toJS(e)},n.bind=function(n,r){e?e(n).each(function(e,n){t.applyBindings(r,n)}):t.applyBindings(r,n)},n.unbind=function(n){e?e(n).each(function(e,n){t.cleanNode(n)}):t.cleanNode(n)},n.ko=t,n}(this.jQuery),r=function(){function e(){}return e.prototype.serialize=function(e){return this.__koConverted!==!0?(this.__koConverted=!0,this.data=n.serialize(this.data||e)):n.serialize(e,this.data),this.data},e.prototype.deserialize=function(){return n.deserialize(this.data)},e.prototype.bind=function(e){e=e||{},e instanceof jQuery&&(e={$el:e});var t=this;e.$el=e.$el||$(document),e.convert!==!1&&this.serialize(),n.bind(e.$el,t.data)},e.prototype.unbind=function(e){e=e||{},e instanceof jQuery&&(e={$el:e}),e.$el=e.$el||$(this._els),n.unbind(e.$el)},e}();return e.koFactory=n,e.koModel=e.model.extend(r),e.koModel});